#include "Movies.h"#include "ext_common.h"#include "ext.h"#include "ext_user.h"#include "n2.basicstrings.c"//#include "Math.h"#include "n2.0000.h"     // n2.inkludestypedef struct zttz {	Object   n_ob;     // required max 	void     *n2hdr;   // required nato - position = signifikant _ must b 2nd		void             *dataout;      // n2data outlet	n2imgptr      gvelt, pix2;         // img buffer        short        red, green, blue, width, height, exchange;     // var!ablz	float		xredpercent, xgreenpercent, xbluepercent, 			yredpercent, ygreenpercent, ybluepercent,					xpercent, ypercent;    Boolean          on,bypass,freeze,think,quarrel, clear;  // nato.objstate flagz + cherry} NNato;void *nnato_new(long variant);void nnato_assist(NNato *x, void *b, long msg, long nr, char *s);void nnato_info(NNato *x, void *p, void *b);void nnato_free(NNato *x);void nnato_processimage(NNato *x, n2atom *data);		//	+void nnato_processimage2(NNato *x, n2atom *data);	//	/void nnato_processimage3(NNato *x, n2atom *data);	//	*void nnato_processimage4(NNato *x, n2atom *data);	//	|void nnato_processimage5(NNato *x, n2atom *data);	//	&void nnato_processimage6(NNato *x, n2atom *data);	//	^void nnato_processimage7(NNato *x, n2atom *data);	//	avgvoid nnato_processimage8(NNato *x, n2atom *data);	//	%void nnato_processimage9(NNato *x, n2atom *data);void nnato_processimage10(NNato *x, n2atom *data);void nnato_processimage11(NNato *x, n2atom *data);void nnato_processimage12(NNato *x, n2atom *data);void nnato_processimage13(NNato *x, n2atom *data);void nnato_processimage14(NNato *x, n2atom *data);void nnato_processimage15(NNato *x, n2atom *data);void nnato_processimage16(NNato *x, n2atom *data);void nnato_processimage17(NNato *x, n2atom *data);	//	<< unklampedvoid nnato_processimage18(NNato *x, n2atom *data);	//	>>void nnato_processimage19(NNato *x, n2atom *data);	//	<< klampedvoid nnato_processimage20(NNato *x, n2atom *data);	//	>>  void nnato_on(NNato *x, long flag);void nnato_bypass(NNato *x, long flag);void nnato_freeze(NNato *x, long flag);void nnato_int(NNato *x, long n);void nnato_bang(NNato *x);void nnato_think(NNato *x, short val);void nnato_quarrel(NNato *x, short val);void nnato_variant(NNato *x, short variant);void nnato_clear(NNato *x);void nnato_weight(NNato *x, short weight);void nnato_exchange(NNato *x, short exchange);void nnato_red(NNato *x, short red);void nnato_green(NNato *x, short green);void nnato_blue(NNato *x, short blue);void nnato_xpercent(NNato *x, long num, long div);				// void nnato_xredpercent(NNato *x, long num, long div);void nnato_xgreenpercent(NNato *x, long num, long div);			void nnato_xbluepercent(NNato *x, long num, long div);			 void nnato_ypercent(NNato *x, long num, long div);				void nnato_yredpercent(NNato *x, long num, long div);			void nnato_ygreenpercent(NNato *x, long num, long div);void nnato_ybluepercent(NNato *x, long num, long div);		void  nnato_percent(NNato *x, long num1, long num2, long div);void nnato_xrgbpercent(NNato *x, long red, long green, long blue, long div);void nnato_yrgbpercent(NNato *x, long red, long green, long blue, long div);void nnato_xyrgbpercent(NNato *x, long red1, long green1, long blue1, long red2, long green2, long blue2,long div);//should work?void     *nnato_class;main(void){	setup(&nnato_class, nnato_new, (method)nnato_free, (short)sizeof(NNato), 0L, 	      A_DEFLONG, 0);    n2objaddimagecmd();    n2addstatecmd((method)nnato_int,(method)nnato_bang,                  (method)nnato_on,(method)nnato_freeze,(method)nnato_bypass,                  (method)nnato_think,(method)nnato_quarrel,(method)nnato_variant,0); 	addmess((method)nnato_assist,	                   "assist",    	A_CANT,0); 	addmess((method)nnato_info,	                 "info",		A_CANT,0);    addmess((method)nnato_red,                        "r",           A_DEFLONG,0);    addmess((method)nnato_green,                     "g",           A_DEFLONG,0);    addmess((method)nnato_blue,                       "b",           A_DEFLONG,0);    addmess((method)nnato_weight,                  "+",           A_DEFLONG,0);    addmess((method)nnato_xpercent,               "%.1",           A_DEFLONG, A_DEFLONG, 0);    addmess((method)nnato_ypercent,               "%.2",           A_DEFLONG, A_DEFLONG, 0);    addmess((method)nnato_xrgbpercent,            "%1",           A_DEFLONG, A_DEFLONG, A_DEFLONG, A_DEFLONG, 0);    addmess((method)nnato_yrgbpercent,             "%2",           A_DEFLONG, A_DEFLONG, A_DEFLONG, A_DEFLONG, 0);        addmess((method)nnato_percent,                      "%",           A_DEFLONG, A_DEFLONG,A_DEFLONG, 0);   addmess((method)nnato_xyrgbpercent,             "%%",           A_DEFLONG, A_DEFLONG,A_DEFLONG,   													A_DEFLONG, A_DEFLONG,A_DEFLONG,A_DEFLONG, 0);    addmess((method)nnato_exchange,                        "exchange",           A_DEFLONG,0);    addmess((method)nnato_exchange,                        "flip",           A_DEFLONG,0);    addmess((method)nnato_clear,                        "clear",0);	//supporting clearing grafport    n2addfklass("242.++");//	post("242.++   .	        +                                                        +                      sier2001+");//	post("           .	                               . ");	post("242.op.++");  }void nnato_assist(NNato *x, void *b, long msg, long nr, char *s){	if (msg == 1)      		sprintf(s, "n2IMAGE  #%ld", nr);    else       {	   if (msg == 2)   	         strcpy( s, "n2IMAGE.out");	   }}void nnato_info(NNato *x, void *p, void *b){      n2info();}void *nnato_new(long variant){	NNato      *x;    	short      err;  		x = (NNato *)newobject(nnato_class);    	n2addoutlet(x,&x->dataout);    //	x->width = n2idefwidth;//	x->height = n2idefheight;    if (err = n2objinit(x))       { post("242.++ :  n2objinit err = %ld",err); return;}            if ((err = n2inewimage(&x->gvelt,n2idefwidth,n2idefheight)))       { post("242.++ :  n2inewimage err = %ld",err); goto ikk;}      if ((err = n2inewimage(&x->pix2,n2idefwidth,n2idefheight)))    { post("242.++:  n2inewimage err = %ld",err); goto ikk;}      if (err = n2objnewimagebuffer(x,2,0,0)) goto ikk; //   if ((err =  n2objaddmatrixcmd()))  				  //  { post("242.++:  matrix.fails = %ld",err); goto ikk;}         if (!variant)       n2objsetimagefun(x,(method)nnato_processimage);    else if (variant == 1)       n2objsetimagefun(x,(method)nnato_processimage2);   else if (variant == 2)       n2objsetimagefun(x,(method)nnato_processimage3);   else if (variant == 3)       n2objsetimagefun(x,(method)nnato_processimage4);   else if (variant == 4)       n2objsetimagefun(x,(method)nnato_processimage5);   else if (variant == 5)       n2objsetimagefun(x,(method)nnato_processimage6);   else if (variant == 6)       n2objsetimagefun(x,(method)nnato_processimage7);   else if (variant == 7)       n2objsetimagefun(x,(method)nnato_processimage8);  else if (variant == 8)       n2objsetimagefun(x,(method)nnato_processimage19);  //	<< klamped   else if (variant == 9)       n2objsetimagefun(x,(method)nnato_processimage20);       //	>> klamped	     else if (variant == 10)       n2objsetimagefun(x,(method)nnato_processimage9);   else if (variant == 11)       n2objsetimagefun(x,(method)nnato_processimage10);   else if (variant == 12)       n2objsetimagefun(x,(method)nnato_processimage11);   else if (variant == 13)       n2objsetimagefun(x,(method)nnato_processimage12);   else if (variant == 14)       n2objsetimagefun(x,(method)nnato_processimage13);   else if (variant == 15)       n2objsetimagefun(x,(method)nnato_processimage14);   else if (variant == 16)       n2objsetimagefun(x,(method)nnato_processimage15);   else if (variant == 17)       n2objsetimagefun(x,(method)nnato_processimage16);       	  else if (variant == 18)       n2objsetimagefun(x,(method)nnato_processimage17);   else if (variant == 19)       n2objsetimagefun(x,(method)nnato_processimage18);       		x->red = x->green = x->blue = x->exchange = 0;		x->xredpercent =  .5;	x->xgreenpercent =  .5;	x->xbluepercent =  .5;	x->yredpercent =  .5;	x->ygreenpercent =  .5;	x->ybluepercent =  .5;	        n2objaddinlets(x,1);    	x->on = true;    x->bypass = x->freeze = x->think = x->quarrel = false;         return (x);ikk:	nnato_free(x);}void nnato_free(NNato *x){    if (x->gvelt) { n2idisposeimage(x->gvelt); x->gvelt = 0;}    if (x->pix2) { n2idisposeimage(x->pix2); x->pix2 = 0;}    n2objfree(x);}void nnato_on(NNato *x, long flag){        x->on = flag;}    void nnato_bypass(NNato *x, long flag){        x->bypass = flag;}      void nnato_freeze(NNato *x, long flag){        x->freeze = flag;} void nnato_int(NNato *x, long n){   n2defintstatefun(x,n);}void nnato_variant(NNato *x, short variant) //0-7, 10-17{   if (!variant)       n2objsetimagefun(x,(method)nnato_processimage);    else if (variant == 1)       n2objsetimagefun(x,(method)nnato_processimage2);   else if (variant == 2)       n2objsetimagefun(x,(method)nnato_processimage3);   else if (variant == 3)       n2objsetimagefun(x,(method)nnato_processimage4);   else if (variant == 4)       n2objsetimagefun(x,(method)nnato_processimage5);   else if (variant == 5)       n2objsetimagefun(x,(method)nnato_processimage6);   else if (variant == 6)       n2objsetimagefun(x,(method)nnato_processimage7);   else if (variant == 7)       n2objsetimagefun(x,(method)nnato_processimage8);   else if (variant == 8)       n2objsetimagefun(x,(method)nnato_processimage19);   else if (variant == 9)       n2objsetimagefun(x,(method)nnato_processimage20);       	        else if (variant == 10)       n2objsetimagefun(x,(method)nnato_processimage9);   else if (variant == 11)       n2objsetimagefun(x,(method)nnato_processimage10);   else if (variant == 12)       n2objsetimagefun(x,(method)nnato_processimage11);   else if (variant == 13)       n2objsetimagefun(x,(method)nnato_processimage12);   else if (variant == 14)       n2objsetimagefun(x,(method)nnato_processimage13);   else if (variant == 15)       n2objsetimagefun(x,(method)nnato_processimage14);   else if (variant == 16)       n2objsetimagefun(x,(method)nnato_processimage15);   else if (variant == 17)       n2objsetimagefun(x,(method)nnato_processimage16);       	  else if (variant == 18)       n2objsetimagefun(x,(method)nnato_processimage17);   else if (variant == 19)       n2objsetimagefun(x,(method)nnato_processimage18);       	}void nnato_bang(NNato *x){   n2registerimage(x,n2objtype,x->dataout,0,x->gvelt);}void nnato_think(NNato *x, short val){   x->think = val;}void nnato_quarrel(NNato *x, short val){   x->quarrel = val;}void nnato_clear(NNato *x){  x->clear=1; }void nnato_red(NNato *x, short red){   x->red = red;}void nnato_green(NNato *x, short green){   x->green = green;}void nnato_blue(NNato *x, short blue){   x->blue = blue;}void nnato_weight(NNato *x, short weight){   x->green = x->blue = x->red = weight;}void nnato_xredpercent(NNato *x, long num, long div){	if (!div) x->xredpercent= num/1;	else		 x->xredpercent= (float) num/div;}void nnato_xgreenpercent(NNato *x, long num, long div){	if (!div) x->xgreenpercent= num/1;	else		 x->xgreenpercent= (float) num/div;}void nnato_xbluepercent(NNato *x, long num, long div){	if (!div) x->xbluepercent= num/1;	else		 x->xbluepercent= (float) num/div;}void nnato_yredpercent(NNato *x, long num, long div){	if (!div) x->yredpercent= num/1;	else		 x->yredpercent= (float) num/div;}void nnato_ygreenpercent(NNato *x, long num, long div){	if (!div) x->ygreenpercent= num/1;	else		 x->ygreenpercent= (float) num/div;}void nnato_ybluepercent(NNato *x, long num, long div){	if (!div) x->ybluepercent= num/1;	else		 x->ybluepercent= (float) num/div;}void nnato_exchange(NNato *x, short exchange){   x->exchange=exchange % 2; }void  nnato_xpercent(NNato *x, long num, long div){		if (!div) x->xredpercent=x->xgreenpercent=x->xbluepercent= num/1;	else		 x->xredpercent=x->xgreenpercent=x->xbluepercent = (float) num/div;}void  nnato_ypercent(NNato *x, long num, long div){		if (!div) x->yredpercent=x->ygreenpercent=x->ybluepercent= num/1;	else		x->yredpercent=x->ygreenpercent=x->ybluepercent= (float) num/div;//	post("y= %f", x->ypercent);}void  nnato_percent(NNato *x, long num1, long num2, long div){		if (!div) {x->ypercent= num2/1; x->xpercent= num1/1;}	else		{x->ypercent= (float) num2/div; x->xpercent= (float) num1/div ;}//	post("y= %f", x->ypercent);}void nnato_xrgbpercent(NNato *x, long red, long green, long blue, long div){	if (!div) {x->xredpercent= red /1; x->xgreenpercent= green /1; x->xbluepercent= blue /1;}	else		{x->xredpercent= (float)red /div; x->xgreenpercent= (float)green /div; x->xbluepercent=(float) blue /div;}}void nnato_yrgbpercent(NNato *x, long red, long green, long blue, long div){	if (!div) {x->yredpercent= red /1; x->ygreenpercent= green /1; x->ybluepercent= blue /1;}	else		{x->yredpercent= (float)red /div; x->ygreenpercent= (float)green /div; x->ybluepercent=(float) blue /div;}}void nnato_xyrgbpercent(NNato *x, long red1, long green1, long blue1, long red2, long green2, long blue2,long div){	if (!div) {x->yredpercent= red2 /1; x->ygreenpercent= green2 /1; x->ybluepercent= blue2 /1;	              x->xredpercent= red1 /1; x->xgreenpercent= green1 /1; x->xbluepercent= blue1 /1;																			}	else		{x->yredpercent= (float)red2 /div; x->ygreenpercent= (float)green2 /div; x->ybluepercent=(float) blue2 /div;	 x->xredpercent= (float)red1 /div; x->xgreenpercent= (float)green1 /div; x->xbluepercent=(float) blue1/div;																			}}void nnato_processimage(NNato *x, n2atom *data) {                      Boolean 	cherry=x->clear; // as j bernstein suggested++, lets finally turn off 2nd in when its no longer needed    long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;                if (inletnr == 1)        {        	if ((err = n2iensuredimeq(&gveltptr,&x->pix2)))            {             post ("242.++: n2iensureimagedimeq (2) err = %ld", err);             return;            }            n2icopypixraw( gveltptr, x->pix2 );			return;		}                if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);				if ( !srcpixmap2 && !srcpixztate2)			cherry == true; else  cherry == false;        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange)	{          srcadresz = n2igetpixaddr(srcpixmap);	  roubitez  = n2igetpixrowbytes(srcpixmap); 	  	}		else 	{         srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}			        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(redpix + rp2),				         n2klamp255(greenpix + gp2),				         n2klamp255(bluepix + bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}		void nnato_processimage2(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(redpix / rp2),				         n2klamp255(greenpix / gp2),				         n2klamp255(bluepix / bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage3(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(rp2 * redpix),				         n2klamp255(gp2 * greenpix),				         n2klamp255(bp2 * bluepix ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage4(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(redpix | rp2),				         n2klamp255(greenpix | gp2),				         n2klamp255(bluepix | bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage5(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(redpix & rp2),				         n2klamp255(greenpix & gp2),				         n2klamp255(bluepix & bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage6(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(redpix ^ rp2),				         n2klamp255(greenpix ^ gp2),				         n2klamp255(bluepix ^ bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage7(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        if (!x->on || !gveltptr) return;                if (inletnr == 1)        {        	if ((err = n2iensuredimeq(&gveltptr,&x->pix2)))            {             post ("242.++: n2iensureimagedimeq (2) err = %ld", err);             return;            }            n2icopypixraw( gveltptr, x->pix2 );			return;		}                if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				        n2klamp255 ((redpix + rp2)/2),				       n2klamp255 ((greenpix + gp2)/2),				      n2klamp255   ((bluepix + bp2 )/2));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}		void nnato_processimage8(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				       n2klamp255  (redpix % rp2),				      n2klamp255   (greenpix % gp2),				    n2klamp255     (bluepix % bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage9(NNato *x, n2atom *data) // same as 1, no klamping{                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;                if (inletnr == 1)        {        	if ((err = n2iensuredimeq(&gveltptr,&x->pix2)))            {             post ("242.++: n2iensureimagedimeq (2) err = %ld", err);             return;            }            n2icopypixraw( gveltptr, x->pix2 );			return;		}                if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         (redpix + rp2),				         (greenpix + gp2),				        (bluepix + bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}		void nnato_processimage10(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         (redpix / rp2),				         (greenpix / gp2),				         (bluepix / bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage11(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				        (rp2 * redpix),				         (gp2 * greenpix),				         (bp2 * bluepix ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage12(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         (redpix | rp2),				         (greenpix | gp2),				         (bluepix | bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage13(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         (redpix & rp2),				         (greenpix & gp2),				         (bluepix & bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage14(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				        (redpix ^ rp2),				         (greenpix ^ gp2),				         (bluepix ^ bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage15(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        if (!x->on || !gveltptr) return;                if (inletnr == 1)        {        	if ((err = n2iensuredimeq(&gveltptr,&x->pix2)))            {             post ("242.++: n2iensureimagedimeq (2) err = %ld", err);             return;            }            n2icopypixraw( gveltptr, x->pix2 );			return;		}                if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				         ((redpix + rp2)/2),				       ((greenpix + gp2)/2),				        ((bluepix + bp2 )/2));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}		void nnato_processimage16(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				          (redpix % rp2),				         (greenpix % gp2),				          (bluepix % bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage17(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				          (redpix << rp2),				         (greenpix << gp2),				          (bluepix << bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage18(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				          (redpix >> rp2),				         (greenpix >> gp2),				          (bluepix >> bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage19(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				          n2klamp255(redpix << rp2),				        n2klamp255 (greenpix << gp2),				        n2klamp255  (bluepix << bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage20(NNato *x, n2atom *data){                       long           i, j, roubitez, roubitez2, pix, pix2, inletnr = n2objgetinletnr(x);                              short          red   = x->red, green = x->green, blue= x->blue,                   width, height, heightold=x->height, widthold=x->width, err, redpix, greenpix, bluepix, rp2, gp2, bp2;                        Ptr            src, src2, dst, srcadresz, dstadresz, srcadresz2;          n2pixmaphdl    srcpixmap, dstpixmap, srcpixmap2;    n2pixstate     srcpixztate, dstpixztate, srcpixztate2;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data) ;        err = n2iensuredimeq(&gveltptr,n2objgetimagenr(x,inletnr));         if (!x->on) return;          	n2icopypixraw(*n2objgetimagenr(x,0), gveltptr);          	err = n2iensuredimeq(&gveltptr,&x->gvelt);                        if (inletnr == 1) {				x->pix2 = gveltptr;          	        }          if (inletnr > 0) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.++ : n2iensureimagedimeq err = %ld", err);             return;           }           if (!x->think)                      srcpixmap   = srcpixmap2 = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                                   dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                        dstpixztate = n2igetpixstate(dstpixmap);        		srcpixmap2 = n2igetpixmap(x->pix2);		srcpixztate2 = n2igetpixstate(srcpixmap2);        if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                     if (!n2ilockpix(srcpixmap2)) return;               dstadresz = n2igetpixaddr(dstpixmap);	if(!x->exchange){        srcadresz = n2igetpixaddr(srcpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap); 	        srcadresz2 = n2igetpixaddr(srcpixmap2);		roubitez2  = n2igetpixrowbytes(srcpixmap2); 		}	else 	{        srcadresz = n2igetpixaddr(srcpixmap2);		roubitez  = n2igetpixrowbytes(srcpixmap2); 	        srcadresz2 = n2igetpixaddr(srcpixmap);		roubitez2  = n2igetpixrowbytes(srcpixmap); 		}        n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        src2 = srcadresz2 + i * roubitez2;                        dst = dstadresz + i * roubitez;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);				pix2 = n2get32(src2);                redpix = x->xredpercent * n2get32red(pix) + red;                greenpix = x->xgreenpercent * n2get32green(pix) + green;                bluepix = x->xbluepercent * n2get32blue(pix) + blue;                rp2 =x->yredpercent * n2get32red(pix2) + red;                gp2 =x->ygreenpercent * n2get32green(pix2) + green;                bp2 =x->ybluepercent * n2get32blue(pix2) + blue;				n2set32m(dst,				         n2get32alpha(pix),				       n2klamp255   (redpix >> rp2),				       n2klamp255  (greenpix >> gp2),				        n2klamp255  (bluepix >> bp2 ));				src+=4;				src2+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);        if (heightold!=height) x->height=height;        if (widthold!=width) x->width=width;        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);                return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);	    n2isetpixstate(srcpixmap2,srcpixztate2);        n2isetpixstate(dstpixmap,dstpixztate);}/*.*/