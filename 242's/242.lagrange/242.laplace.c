// sier. gaussian image deviation .   built:07.03.2001// rephrased  19.03.2001#include "Movies.h"#include "ext_common.h"#include "ext.h"#include "ext_user.h"#include "math.h"#include "n2.basicstrings.c"#include "n2.0000.h"     // n2.inkludestypedef struct zttz {	Object   n_ob;     // required max 	void     *n2hdr;   // required nato - position = signifikant _ must b 2nd		void             *dataout;      // n2data outlet	n2imgptr         gvelt;         // img buffer	long               centre, stdDev, floor, peak, power, plus, variant;	    Boolean          on,bypass,freeze,think,quarrel;  // nato.objstate flagz} NNato;void *nnato_new(short variant);void nnato_assist(NNato *x, void *b, long msg, long nr, char *s);void nnato_info(NNato *x, void *p, void *b);void nnato_free(NNato *x);void nnato_processimage(NNato *x, n2atom *data);void nnato_processimage2(NNato *x, n2atom *data);void nnato_processimage3(NNato *x, n2atom *data);void nnato_processimage4(NNato *x, n2atom *data);void nnato_processimage5(NNato *x, n2atom *data);void nnato_processimage6(NNato *x, n2atom *data);void nnato_processimage7(NNato *x, n2atom *data);void nnato_processimage8(NNato *x, n2atom *data);void nnato_processimage9(NNato *x, n2atom *data);void nnato_processimage10(NNato *x, n2atom *data);void nnato_processimage11(NNato *x, n2atom *data);void nnato_processimage12(NNato *x, n2atom *data);void nnato_on(NNato *x, long flag);void nnato_bypass(NNato *x, long flag);void nnato_freeze(NNato *x, long flag);void nnato_int(NNato *x, long n);void nnato_bang(NNato *x);void nnato_think(NNato *x, short val);void nnato_quarrel(NNato *x, short val);void nnato_variant(NNato *x, short variant);void nnato_centre(NNato *x,   long centre);void nnato_stdDev(NNato *x,long stdDev);void nnato_floor(NNato *x,  long floor);void nnato_peak(NNato *x, long peak);void nnato_power(NNato *x, long power);void nnato_plus(NNato *x, long plus);long expp (long a, long b);void     *nnato_class;main(void){	setup(&nnato_class, nnato_new, (method)nnato_free, (short)sizeof(NNato), 0L, 	      A_DEFLONG, 0);    n2objaddimagecmd();    n2addstatecmd((method)nnato_int,(method)nnato_bang,                  (method)nnato_on,(method)nnato_freeze,(method)nnato_bypass,                  (method)nnato_think,(method)nnato_quarrel,(method)nnato_variant,0); 	addmess((method)nnato_assist,	                   "assist",    	A_CANT,0); 	addmess((method)nnato_info,	                       "info",		    A_CANT,0);    addmess((method)nnato_centre,                     "centre",           A_DEFLONG,0);    addmess((method)nnato_stdDev,                   "dev",         A_DEFLONG,0);    addmess((method)nnato_floor,                    "floor",          A_DEFLONG,0);    addmess((method)nnato_peak,                        "peak",           A_DEFLONG,0);    addmess((method)nnato_power,                        "pow",           A_DEFLONG,0);    addmess((method)nnato_plus,                        "+",           A_DEFLONG,0);    n2addfklass("242.laplaces");//        post("");    //    post("");       // post("      \\"); //       post("           \\\     \\\\     \\\ \   \\\\       +");//        post("");  //      post(""); //       post("");   //     post("");   //     post("\\    \\                \\                                     \\\           \\          \\\\                               \\               / /");        post(" 242.laplace> [c]sier, 2001                         \\                               \\\               \\");}void nnato_assist(NNato *x, void *b, long msg, long nr, char *s){	if (msg == 1)      // !nlet	   sprintf(s, "n2ImageIn: variant_%ld", x->variant);      else       {	   if (msg == 2)   // outlet	      if (nr == 0)	         sprintf(s, "n2Imageout: %ld_%ld__%ld", x->peak, x->floor, x->variant);        }}void nnato_info(NNato *x, void *p, void *b){      n2info();}void *nnato_new(short variant){	NNato      *x;    short      err;  		x = (NNato *)newobject(nnato_class);    n2addoutlet(x,&x->dataout);        if (err = n2objinit(x))       { post("242.gauss  :  n2objinit err = %ld",err); return;}            if ((err = n2inewimage(&x->gvelt,n2idefwidth,n2idefheight)))       { post("242.gauss  :  n2inewimage err = %ld",err); goto ikk;}      n2objsetimagefun(x,(method)nnato_processimage);		// igniting...	if(variant) x->variant = variant; else  x->variant = 0;	x->centre = 160;     x->peak = -40;	  x->stdDev = 110;	  x->floor = 3;	x->power=2;		x->plus=0;   	x->on = true;    x->bypass = x->freeze = x->think = x->quarrel = false;           return (x);ikk:	nnato_free(x);}void nnato_free(NNato *x){    if (x->gvelt) { n2idisposeimage(x->gvelt); x->gvelt = 0;}    n2objfree(x);}void nnato_on(NNato *x, long flag){        x->on = flag;}    void nnato_bypass(NNato *x, long flag){        x->bypass = flag;}      void nnato_freeze(NNato *x, long flag){        x->freeze = flag;} void nnato_int(NNato *x, long n){   n2defintstatefun(x,n);}void nnato_bang(NNato *x){   n2registerimage(x,n2objtype,x->dataout,0,x->gvelt);}void nnato_think(NNato *x, short val){   x->think = val;}void nnato_quarrel(NNato *x, short val){   x->quarrel = val;}void nnato_variant(NNato *x, short variant){   if (!variant)       n2objsetimagefun(x,(method)nnato_processimage);    else if (variant == 1)       n2objsetimagefun(x,(method)nnato_processimage2);   else if (variant == 2)       n2objsetimagefun(x,(method)nnato_processimage3);   else if (variant == 3)       n2objsetimagefun(x,(method)nnato_processimage4);   else if (variant == 4)       n2objsetimagefun(x,(method)nnato_processimage5);   else if (variant == 5)       n2objsetimagefun(x,(method)nnato_processimage6);   else if (variant == 6)       n2objsetimagefun(x,(method)nnato_processimage7);   else if (variant == 7)       n2objsetimagefun(x,(method)nnato_processimage8);   else if (variant == 8)       n2objsetimagefun(x,(method)nnato_processimage9);   else if (variant == 9)       n2objsetimagefun(x,(method)nnato_processimage10);   else if (variant == 10)       n2objsetimagefun(x,(method)nnato_processimage11);   else if (variant == 11)      n2objsetimagefun(x,(method)nnato_processimage12);        }void nnato_centre(NNato *x, long centre){   x->centre = centre;}void nnato_stdDev(NNato *x, long stdDev){   x->stdDev = stdDev;}void nnato_peak(NNato *x, long peak){   x->peak = peak;}void nnato_floor(NNato *x, long floor){   x->floor = floor;}void nnato_power(NNato *x, long power){   x->power = power;}void nnato_plus(NNato *x, long plus){   x->plus = plus;}long expp (long a, long b){	return (pow(a,b));}void nnato_processimage(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b, rv, gv, bv, curavg, goutr,goutg,goutb=0,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                  if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);//          gout = (b*exp((-1*pow( (i - x->centre), 2)) /a) + x->floor + 0.5) + x->plus;                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                                               for(j = 0; j < width; j++)            {                pix = n2get32(src);  				         rv=(n2get32red(pix) );				         gv=(n2get32green(pix));				         bv=(n2get32blue(pix) );				         				         curavg = (rv + gv + bv)/(3*(height+width)); //more or less one pixl average				         				         goutr = (a/2) exp (-a*( rv - curagv));     					 goutg = (a/2) * exp (-a*( gv - curagv));     					 goutb = (a/2)* exp (-a*( bv - curagv));                      				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(rv   + goutr),				         n2klamp255(gv + goutg),				         n2klamp255(bv  + goutb));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}		void nnato_processimage2(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                                           if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                     gout = (b*exp((-1*pow( (i - x->centre), 2)) /a) + x->floor + 0.5);                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);     //              gout = (b*exp((-1*pow( (j - x->centre), 2)) /a) + x->floor + 0.5) + x->plus;                				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(n2get32red(pix)   + gout),				         n2klamp255(n2get32green(pix) + gout),				         n2klamp255(n2get32blue(pix)  + gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage3(NNato *x, n2atom *data)  {                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                   if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);  gout = (b*exp((-1*pow( (j+i - x->centre), powr)) /a) + x->floor + 0.5) +x->plus;                     for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                                                     for(j = 0; j < width; j++)            {                pix = n2get32(src);    //              gout = (b*exp((-1*pow( (j+i - x->centre), powr)) /a) + x->floor + 0.5) +x->plus; 					n2set32m(dst,				         n2get32alpha(pix),				         n2klamp655(n2get32red(pix)  + gout),				         n2klamp655(n2get32green(pix) + gout),				         n2klamp655(n2get32blue(pix)  + gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage4(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor) +x->plus;           gout = gout / 2;                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                  	gout = (b*exp((-1*pow((j+i - x->centre), 2 )) / a ) + x->floor + .5 + x->plus ) ;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);      //             gout = gout + (b*exp((-1*pow( (j - x->centre), 2)) /a) + x->floor + 0.5); //no revers | gout++					n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(n2get32red(pix)+  gout),				         n2klamp255(n2get32green(pix)+ gout),				         n2klamp255(n2get32blue(pix)+ gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage5(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?          gout = gout / 3;                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                                           for(j = 0; j < width; j++)            {                pix = n2get32(src);      					n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(n2get32red(pix)+  gout),				         n2klamp255(n2get32green(pix)+ gout),				         n2klamp255(n2get32blue(pix)+ gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage6(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                  gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?          gout = gout / 2;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);     				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255(n2get32red(pix)   + gout),				         n2klamp255(n2get32green(pix)+ gout),				         n2klamp255(n2get32blue(pix)   + gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage7(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;             		          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 3;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);       				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix)   / gout)),				         n2klamp255((n2get32green(pix) / gout)),				         n2klamp255((n2get32blue(pix)  / gout)));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage8(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);		          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 2;                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                                           for(j = 0; j < width; j++)            {                pix = n2get32(src);          				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix)   / gout) + n2get32red(pix)),				         n2klamp255((n2get32green(pix) / gout) + n2get32green(pix)),				         n2klamp255((n2get32blue(pix)  / gout) + n2get32blue(pix)));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage9(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;                                           for(j = 0; j < width; j++)            {                pix = n2get32(src);    		          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 3;   				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix)   / gout) + gout),				         n2klamp255((n2get32green(pix) / gout) + gout),				         n2klamp255((n2get32blue(pix)  / gout) + gout));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage10(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;         		          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 2;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src);    				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix) /  expp( gout,2)) + (n2get32red(pix)/gout)),				         n2klamp255((n2get32green(pix) / expp( gout,2)) + (n2get32green(pix)/gout)),				         n2klamp255((n2get32blue(pix)  / expp ( gout,2)) + (n2get32blue(pix)/gout)));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage11(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;         		          gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 2;                                  for(j = 0; j < width; j++)            {                pix = n2get32(src); 				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix)   + expp(gout,2) + 1) / (n2get32red(pix)+ 2*gout -1)),				         n2klamp255((n2get32green(pix) + expp(gout,2) + 1) / (n2get32green(pix)+ 2*gout -1)),				         n2klamp255((n2get32blue(pix)  + expp(gout,2) + 1) / (n2get32blue(pix)+ 2*gout-1)));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}void nnato_processimage12(NNato *x, n2atom *data){                       long           i, j, roubitez, pix, gout;                              short          width, height, err;                        	long		    a, b,					centre = x->centre,					stdDev = x->stdDev,					peak = x->peak,					floor = x->floor,					powr = x->power;    Ptr            src, dst, srcadresz, dstadresz;          n2pixmaphdl    srcpixmap, dstpixmap;    n2pixstate     srcpixztate, dstpixztate;    n2imgptr       dstgvelt, gveltptr = n2getatomimage(data);        if (!x->on || !gveltptr) return;        if (x->freeze)           {                 n2registerimage(x,n2objtype,x->dataout,data,x->gvelt);              return;           }                       if (x->bypass)           {              n2registerimage(x,n2objtype,x->dataout,data,gveltptr);              return;              }         if ((err = n2iensuredimeq(&gveltptr,&x->gvelt)))           {             post ("242.gauss  : n2iensureimagedimeq err = %ld", err);             return;           }                                  	a = 2 * pow(x->stdDev, powr);			b = (x->peak - x->floor);                     if (!x->think)                      srcpixmap   = n2igetpixmap(gveltptr);        else            srcpixmap   = n2igetpixmap(x->gvelt);               if (!x->quarrel)             dstgvelt = x->gvelt;        else            dstgvelt = gveltptr;                         dstpixmap   = n2igetpixmap(dstgvelt);         srcpixztate = n2igetpixstate(srcpixmap);                dstpixztate = n2igetpixstate(dstpixmap);                if (!n2ilockpix(srcpixmap)) return;               if (!n2ilockpix(dstpixmap)) goto ikk;                      srcadresz = n2igetpixaddr(srcpixmap);        dstadresz = n2igetpixaddr(dstpixmap);		roubitez  = n2igetpixrowbytes(srcpixmap);         n2igetdim(gveltptr,&width,&height);	     gout = (b*exp((-1*pow( (j+i - x->centre), 2)) /a) + x->floor + gout) +x->plus;  // fractal behaviour ?		          gout = gout / 2;                    for(i = 0; i < height; i++)          {            src = srcadresz + i * roubitez;                        dst = dstadresz + i * roubitez;          	                         for(j = 0; j < width; j++)            {                pix = n2get32(src); 				n2set32m(dst,				         n2get32alpha(pix),				         n2klamp255((n2get32red(pix)   + expp(gout,2) + 1) / (n2get32red(pix)+ 2*gout -1)),				         n2klamp255((n2get32green(pix) + expp(gout,2) + 1) / (n2get32green(pix)+ 2*gout -1)),				         n2klamp255((n2get32blue(pix)  + expp(gout,2) + 1) / (n2get32blue(pix)+ 2*gout-1)));				src+=4;				dst+=4;					             }		 }  	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);        n2registerimage(x,n2objtype,x->dataout,data,dstgvelt);        return;        ikk: 	    n2isetpixstate(srcpixmap,srcpixztate);        n2isetpixstate(dstpixmap,dstpixztate);}